<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Feed | MediaMind AI</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { background-color: #0B1121; color: #e2e8f0; font-family: 'Outfit', sans-serif; }
        .glass-panel { background: rgba(30, 41, 59, 0.4); backdrop-filter: blur(20px); border: 1px solid rgba(255,255,255,0.05); box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37); }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .fade-in { animation: fadeIn 0.4s ease-out forwards; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .animate-slide-up { animation: slideUp 0.5s ease-out forwards; }
    </style>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect } = React;
        const API_BASE = "http://127.0.0.1:8000";

        const LoadingDots = () => (
            <div className="flex space-x-1 items-center justify-center p-4">
                <div className="w-2 h-2 bg-blue-500 rounded-full animate-bounce" style={{animationDelay: '0s'}}></div>
                <div className="w-2 h-2 bg-blue-500 rounded-full animate-bounce" style={{animationDelay: '0.1s'}}></div>
                <div className="w-2 h-2 bg-blue-500 rounded-full animate-bounce" style={{animationDelay: '0.2s'}}></div>
            </div>
        );

        const Icon = ({ name, size = 18, className = '' }) => {
            const icons = {
                'sliders': 'üéöÔ∏è',
                'cpu': 'üíª',
                'trophy': 'üèÜ',
                'globe': 'üåê',
                'trending-up': 'üìà',
                'activity': 'üìç',
                'gamepad-2': 'üéÆ',
                'check': '‚úì',
                'refresh-cw': 'üîÑ',
                'bookmark': 'üîñ',
                'clock': 'üïê',
                'arrow-right': '‚Üí',
            };
            return <span className={className} style={{fontSize: `${size}px`}}>{icons[name] || '‚Ä¢'}</span>;
        };

        const FeatureRecommendation = () => {
            // Load saved data from localStorage using lazy initialization (runs only once)
            const [interests, setInterests] = useState(() => {
                try {
                    return JSON.parse(localStorage.getItem('feed_interests')) || ["Technology"];
                } catch { return ["Technology"]; }
            });
            const [articles, setArticles] = useState(() => {
                try {
                    return JSON.parse(localStorage.getItem('feed_articles')) || [];
                } catch { return []; }
            });
            const [loading, setLoading] = useState(false);
            const allInterests = [{id: "Technology", i:"cpu"}, {id: "Sports", i:"trophy"}, {id: "Politics", i:"globe"}, {id: "Finance", i:"trending-up"}, {id: "Health", i:"activity"}, {id: "Gaming", i:"gamepad-2"}];

            const toggleInterest = (tag) => {
                setInterests(prev => {
                    const newInterests = prev.includes(tag) ? prev.filter(t => t !== tag) : [...prev, tag];
                    localStorage.setItem('feed_interests', JSON.stringify(newInterests));
                    return newInterests;
                });
            };
            const getRecs = async () => {
                setLoading(true);
                try {
                    const res = await fetch(`${API_BASE}/feature-2/recommend`, {
                        method: 'POST',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify({ user_interests: interests, available_articles: [] })
                    });
                    if(res.ok) {
                        const data = (await res.json()).recommended_articles || [];
                        setArticles(data);
                        localStorage.setItem('feed_articles', JSON.stringify(data));
                    }
                } catch(e) {
                    const fallback = [{id: 1, title: "Backend Offline", category: "System", source: "Local", time: "Now", snippet: "Start python backend.", image: "https://placehold.co/600x400/1e293b/FFF?text=Offline"}];
                    setArticles(fallback);
                    localStorage.setItem('feed_articles', JSON.stringify(fallback));
                }
                setLoading(false);
            };

            return (
                <div className="min-h-screen bg-[#0B1121] flex flex-col p-6 fade-in">
                    <a href="index.html" className="absolute top-6 left-6 bg-gray-800 text-white py-2 px-4 rounded-lg hover:bg-gray-700 transition">‚Üê Back</a>
                    <div className="mb-6 text-center">
                        <h1 className="text-3xl font-bold text-white mb-2">Smart Feed Curator</h1>
                        <p className="text-gray-400">Personalized content recommendations powered by AI</p>
                    </div>
                    <div className="flex flex-col lg:flex-row gap-6 flex-1">
                        <div className="w-full lg:w-96 flex-shrink-0">
                            <div className="glass-panel p-6 rounded-xl sticky top-6">
                                <h3 className="font-bold text-white mb-4 flex items-center gap-2"><Icon name="sliders" size={18} /> Feed Preferences</h3>
                                <div className="space-y-2 mb-6">
                                    {allInterests.map(item => (
                                        <button key={item.id} onClick={() => toggleInterest(item.id)} className={`w-full flex items-center gap-3 px-4 py-3 rounded-lg text-sm transition-all ${interests.includes(item.id) ? 'bg-gradient-to-r from-blue-600 to-blue-500 text-white shadow-lg shadow-blue-900/50' : 'bg-slate-800/50 text-gray-400 hover:bg-slate-800 border border-slate-700/50'}`}>
                                            <Icon name={item.i} size={16} /> 
                                            <span className="flex-1 text-left">{item.id}</span>
                                            {interests.includes(item.id) && <Icon name="check" size={14} />}
                                        </button>
                                    ))}
                                </div>
                                <button onClick={getRecs} className="w-full bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-500 hover:to-purple-500 text-white py-3 rounded-lg font-bold transition shadow-lg shadow-purple-900/50 flex items-center justify-center gap-2">
                                    {loading ? <><div className="w-4 h-4 border-2 border-purple-300 border-t-white rounded-full animate-spin"></div> Loading...</> : <><Icon name="refresh-cw" size={16} /> Curate Feed</>}
                                </button>
                                <div className="mt-4 text-xs text-gray-500 text-center">
                                    {interests.length} interest{interests.length !== 1 ? 's' : ''} selected
                                </div>
                            </div>
                        </div>
                        <div className="flex-1">
                            {loading ? (
                                <div className="flex flex-col items-center justify-center h-96">
                                    <div className="w-12 h-12 border-4 border-blue-500/20 border-t-blue-500 rounded-full animate-spin mb-4"></div>
                                    <p className="text-gray-400">Generating personalized feed...</p>
                                </div>
                            ) : articles.length === 0 ? (
                                <div className="flex flex-col items-center justify-center h-96 glass-panel rounded-2xl">
                                    <div className="text-6xl mb-4">üì∞</div>
                                    <h3 className="text-xl font-bold text-white mb-2">No Articles Yet</h3>
                                    <p className="text-gray-400 mb-6">Select your interests and click "Curate Feed" to get started</p>
                                </div>
                            ) : (
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    {articles.map((article, idx) => (
                                        <div key={idx} className="glass-panel rounded-2xl overflow-hidden group hover:border-blue-500/50 transition-all duration-300 hover:shadow-lg hover:shadow-blue-900/20 cursor-pointer animate-slide-up" style={{animationDelay: `${idx * 100}ms`}}>
                                            <div className="h-48 overflow-hidden relative bg-gradient-to-b from-slate-800 to-slate-900">
                                                <img src={article.image} className="w-full h-full object-cover transition duration-700 group-hover:scale-110" alt="news" onError={(e) => e.target.style.display = 'none'}/>
                                                <div className="absolute inset-0 bg-gradient-to-t from-black/60 to-transparent"></div>
                                                <div className="absolute top-4 left-4">
                                                    <span className="bg-gradient-to-r from-blue-600 to-blue-500 backdrop-blur text-white text-[10px] font-bold px-3 py-1.5 rounded-full">{article.category}</span>
                                                </div>
                                                <div className="absolute top-4 right-4">
                                                    <Icon name="bookmark" size={18} className="text-white opacity-50 group-hover:opacity-100 transition" />
                                                </div>
                                            </div>
                                            <div className="p-5">
                                                <div className="flex justify-between text-xs text-gray-500 mb-3">
                                                    <span className="flex items-center gap-1"><Icon name="globe" size={12} /> {article.source}</span>
                                                    <span className="flex items-center gap-1"><Icon name="clock" size={12} /> {article.time}</span>
                                                </div>
                                                <h3 className="text-lg font-bold text-white leading-tight mb-2 group-hover:text-blue-400 transition line-clamp-2">{article.title}</h3>
                                                <p className="text-sm text-gray-400 line-clamp-2 mb-4">{article.snippet}</p>
                                                <button className="text-blue-400 text-xs font-bold flex items-center gap-1 hover:gap-2 transition">
                                                    Read More <Icon name="arrow-right" size={12} />
                                                </button>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<FeatureRecommendation />);
    </script>
</body>
</html>
